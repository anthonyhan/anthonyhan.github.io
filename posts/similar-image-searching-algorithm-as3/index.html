<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>åŸºäºAS3.0çš„ç›¸ä¼¼å›¾åƒæœç´¢ç®—æ³•å®ç° | LimboNova</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">åŸºäºAS3.0çš„ç›¸ä¼¼å›¾åƒæœç´¢ç®—æ³•å®ç°</span></h1>

<h2 class="date">2012/08/14</h2>
</div>

<main>
<p>Googleçš„å›¾åƒæœç´¢ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·ä¸Šä¼ æˆ–è€…ç½‘ç»œä¸Šçš„å›¾ç‰‡æ‰¾åˆ°ä¸æ­¤æœ€ç›¸ä¼¼çš„å›¾ç‰‡(ç™¾åº¦ä¹Ÿæœ‰ç±»ä¼¼åŠŸèƒ½)ã€‚</p>
<p><img src="https://pjkm4w.bay.livefilestore.com/y1pOjCa3mvtvwKjegr_UmRLkNG9nUpMQU-uMfHod4eqmrtsEsIHz4jI_4yyhi7oe7xURPx9ZOu-lMQsUi8FbN4reRvqjqVlik3i/google_image_search.png" alt="google image search" title="Google Image Search"></p>
<p>é˜®ä¸€å³°çš„åšå®¢æ›¾ç»æåˆ°è¿‡ â€œæ„ŸçŸ¥å“ˆå¸Œç®—æ³•(Perceptual hash algorithm)â€ï¼Œä¸»è¦ä»‹ç»äº† Dr. Neal KrawetzåŸºäºæ„ŸçŸ¥å“ˆå¸Œç®—æ³•çš„â€å¹³å‡å“ˆå¸Œç®—æ³•(Average Hash algorithm)â€ã€‚ç›¸æ¯”å…¶ä»–ç®—æ³•ï¼Œè¿™ç§ç®—æ³•ç®€å•å¿«é€Ÿï¼Œå¾ˆå®¹æ˜“å®ç°ã€‚</p>
<p>å¯¹äºå›¾åƒæ¥è¯´ï¼Œé«˜é¢‘ä¿¡æ¯ä½“ç°å›¾åƒçš„ç»†èŠ‚ï¼Œä½é¢‘ä¿¡æ¯ä½“ç°å›¾åƒçš„è¾¹ç¼˜å’Œè½®å»“ã€‚ä¸€å¹…å¤§è€Œæ¸…æ™°çš„å›¾åƒä¸ä»…åŒ…å«ä½é¢‘ï¼Œè€Œä¸”ä¼šåŒ…å«å¾ˆå¤šé«˜é¢‘åˆ†é‡ã€‚è€Œå°å›¾ç‰‡å› ä¸ºç¼ºä¹ç»†èŠ‚éƒ¨åˆ†ï¼Œå¾€å¾€åªæœ‰ä½é¢‘ä¿¡æ¯ã€‚å› æ­¤ç”¨åªåŒ…å«ä½é¢‘åˆ†é‡çš„å›¾åƒæ¥åšå›¾åƒç›¸ä¼¼åº¦åŒ¹é…æ˜¯éå¸¸åˆé€‚çš„ã€‚</p>
<p>æ„ŸçŸ¥å“ˆå¸Œç®—æ³•çš„åŸºæœ¬åŸç†æ˜¯æ ¹æ®å›¾åƒç‰¹å¾ç”Ÿæˆä¸€ä¸ªç‰¹å®š(ä½†éå”¯ä¸€)çš„æŒ‡çº¹ï¼Œæ ¹æ®æŒ‡çº¹æ¥æ¯”è¾ƒå›¾åƒçš„ç›¸ä¼¼åº¦ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼Œå³ä½¿å›¾åƒæ”¾å¤§ç¼©å°ï¼Œè°ƒæ•´é«˜å®½ï¼Œæˆ–è€…æœ‰å°‘è®¸è‰²å½©å˜åŒ–ï¼ˆå¯¹æ¯”åº¦ï¼Œäº®åº¦ç­‰ç­‰ï¼‰ï¼Œä»ç„¶å¯ä»¥åŒ¹é…åˆ°ç›¸ä¼¼çš„å›¾åƒã€‚</p>
<h2 id="å¹³å‡å“ˆå¸Œç®—æ³•average-hash-algorithm">å¹³å‡å“ˆå¸Œç®—æ³•(Average Hash algorithm)</h2>
<p>å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>ç¼©å°å°ºå¯¸ï¼šç§»é™¤é«˜é¢‘éƒ¨åˆ†ï¼Œå°†å›¾åƒç¼©å°è‡³8Ã—8åƒç´ ,ä¸è€ƒè™‘é«˜å®½æ¯”ï¼›
{% img <a href="https://pjkm4w.bay.livefilestore.com/y1pEQIINXhwtkYhvSu94Q9L0iRya9-bx-0UDrNZDL8yb3_2ODB88DXQAhb3f4Oe8J9Kj8eElRgB1nZy95uSdf8Uye0dNGwDPpWW/reduce_size.jpg">https://pjkm4w.bay.livefilestore.com/y1pEQIINXhwtkYhvSu94Q9L0iRya9-bx-0UDrNZDL8yb3_2ODB88DXQAhb3f4Oe8J9Kj8eElRgB1nZy95uSdf8Uye0dNGwDPpWW/reduce_size.jpg</a> 64 64 %}</p>
</li>
<li>
<p>å‡å°‘é¢œè‰²ï¼šè½¬ä¸ºç°åº¦å›¾ï¼Œå°†64åƒç´ çš„RGB 64Ã—3ä¸ªé¢œè‰²å€¼ç®€åŒ–ä¸º 64ä¸ªè‰²å€¼ï¼›
{% img <a href="https://pjkm4w.bay.livefilestore.com/y1pEQIINXhwtkZyypWiFbXh51KEaUsH1RT_1Qli_UpOupdO-_1PbPXCbINY0UQRbfgfHPmXyoTqz0kcq963cYITTxHLInBtZQGl/reduce_color.jpg">https://pjkm4w.bay.livefilestore.com/y1pEQIINXhwtkZyypWiFbXh51KEaUsH1RT_1Qli_UpOupdO-_1PbPXCbINY0UQRbfgfHPmXyoTqz0kcq963cYITTxHLInBtZQGl/reduce_color.jpg</a> 64 64 %}</p>
</li>
<li>
<p>è®¡ç®—å¹³å‡å€¼ï¼šè®¡ç®—64ä¸ªé¢œè‰²çš„å‡å€¼ï¼›</p>
</li>
<li>
<p>æ¯”è¾ƒç°åº¦å€¼ï¼šå°†æ¯ä¸ªåƒç´ çš„é¢œè‰²å€¼ä¸å¹³å‡å€¼æ¯”è¾ƒï¼Œå°äºå‡å€¼è®°0ï¼Œå¦åˆ™è®°1ï¼›</p>
</li>
<li>
<p>è®¡ç®—å“ˆå¸Œå€¼ï¼šå°†ä¸Šè¿°çš„æ¯”è¾ƒç»“æœæ‹¼èµ·æ¥æ„æˆä¸€ä¸ª64ä½çš„æ•´æ•°ã€‚</p>
</li>
</ol>
<h2 id="phashç®—æ³•">pHashç®—æ³•</h2>
<p>å¹³å‡å“ˆå¸Œç®€å•å¿«é€Ÿï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§ï¼Œå¦‚æœå›¾åƒçš„gammaæ ¡æ­£æˆ–è€…ç›´æ–¹å›¾å˜åŒ–ï¼Œè¯†åˆ«å°±å·®å¤šå•¦ã€‚è¿™æ˜¯å› ä¸ºå›¾åƒé¢œè‰²ç»è¿‡äº†éçº¿æ€§çš„å˜æ¢ï¼Œè€Œä¸Šè¿°ç®—æ³•æ˜¯åŸºäºå¹³å‡å€¼çš„ã€‚æ›´åŠ å¥å£®çš„ç®—æ³•æ˜¯pHashï¼ŒpHashä½¿ç”¨DCT(Discrete Cosine Transform ç¦»æ•£ä½™å¼¦å˜æ¢)æ¥é™é¢‘ã€‚(é«˜æ•°ã€ä¿¡å·å¤„ç†å®Œç’§å½’èµµäº†å—ï¼Ÿ)ã€‚Nealè‡ªå·±å¯¹pHashä½œäº†ç¨ç¨æ”¹åŠ¨ï¼Œä½†æ¦‚å¿µç›¸åŒï¼Œå…¶å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç¼©å°å°ºå¯¸ï¼šç›®çš„æ˜¯å‡å°‘DCTè®¡ç®—é‡ï¼Œè€Œä¸æ˜¯ç§»é™¤é«˜é¢‘åˆ†é‡ï¼Œ32*32åƒç´ ä¸ºå®œï¼›</li>
<li>å‡å°‘é¢œè‰²ï¼šè¿›ä¸€æ­¥å‡å°‘è®¡ç®—é‡ï¼›</li>
<li>è®¡ç®—DCTï¼šDCTå°†å›¾åƒåˆ†å‰²å¤„ç†æˆé¢‘ç‡å’Œæ ‡é‡çš„é›†åˆã€‚JPEGæœ‰æŸå‹ç¼©ä½¿ç”¨8Ã—8 DCTï¼Œè¿™é‡Œä½¿ç”¨32Ã—32 DCTï¼›</li>
<li>å‡å°‘DCTï¼šé‡‡ç”¨32Ã—32 DCTï¼Œä½†åªä¿ç•™å·¦ä¸Šè§’çš„8Ã—8 éƒ¨åˆ†ï¼Œå–è¯¥å›¾åƒçš„æœ€ä½é¢‘éƒ¨åˆ†ã€‚</li>
<li>è®¡ç®—å‡å€¼ï¼šå’Œå¹³å‡å“ˆå¸Œä¸€æ ·ï¼Œè®¡ç®—DCTå‡å€¼ï¼›</li>
<li>å†æ¬¡å‡å°‘DCTï¼šå’ŒDCTå‡å€¼æ¯”è¾ƒï¼Œå¤§äºç­‰äºè®°1ï¼Œå°äºè®°0ã€‚å¾—åˆ°ä¸€ç»„64ä½æ•°ã€‚è¿™ç»„æ•°æ®æ²¡æœ‰æ˜ç¡®æœ€ä½é¢‘çš„ç¡®åˆ‡å€¼ï¼Œä½†æ˜¯æè¿°äº†å’Œå¹³å‡é¢‘ç‡çš„ç›¸å¯¹å…³ç³»ã€‚å› æ­¤åªè¦å›¾åƒæ•´ä½“ç»“æ„ä¸å˜ï¼Œç»“æœä¹Ÿå°†ä¿æŒä¸å˜ã€‚å³ä¾¿ç»è¿‡gammaæ ¡æ­£å’Œç›´æ–¹å›¾æ”¹å˜ä¹Ÿå¯ä»¥æ­£ç¡®åŒ¹é…ã€‚</li>
<li>æ„å»ºå“ˆå¸Œï¼šå°†ä¸Šè¿°64ä½çš„ç»“æœè½¬æ¢ä¸º64ä½æ•´æ•°ã€‚å³å¾—åˆ°è¯¥å›¾åƒçš„HashæŒ‡çº¹ã€‚æƒ³çŸ¥é“æŒ‡çº¹å›¾æ˜¯ä»€ä¹ˆæ ·ï¼Ÿåªè¦è®¾ç½®å€¼(æ ¹æ®å„ä¸ªä½æ˜¯1è¿˜æ˜¯0ä½¿ç”¨+255å’Œ-255)å¹¶å°†32Ã—32 DCTè½¬æ¢å›32Ã—32åƒç´ çš„å›¾åƒã€‚
<img src="http://lh6.googleusercontent.com/-kxozFTZ1CSE/Td8I2HJeLoI/AAAAAAAAB4A/IeFNcx4lRQQ/s800/Alyson_Hannigan_200512-phash-dct.png" alt="phash-dct"> = 8a0303f6df3ec8cd</li>
</ol>
<p>ä¹çœ‹ä¸Šå»åƒæ˜¯éšæœºçš„ç‚¹ç‚¹ã€‚ä½†æ˜¯ä»”ç»†çœ‹å°±ä¼šå‘ç°æ·±è‰²ç‚¹å›´æˆçš„åœˆæ˜¯äººç‰©çš„å¤´å‘ï¼Œå³è¾¹çš„é»‘ç‚¹æ˜¯èƒŒæ™¯å¢™ä¸Šçš„é‚£é“æ°´å¹³çº¿ã€‚</p>
<h2 id="as30-çš„ç®—æ³•å®ç°">AS3.0 çš„ç®—æ³•å®ç°</h2>
<p>å¹³å‡å“ˆå¸Œçš„ç®—æ³•æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ç®€å•åœ°ç”¨ActionScriptå†™äº†ä¸€ä¸‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-actionscript" data-lang="actionscript"><span style="color:#66d9ef">package</span>
{
	<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">flash</span>.<span style="color:#a6e22e">display</span>.Bitmap<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">flash</span>.<span style="color:#a6e22e">display</span>.BitmapData<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">flash</span>.<span style="color:#a6e22e">events</span>.Event<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">flash</span>.<span style="color:#a6e22e">events</span>.MouseEvent<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">flash</span>.<span style="color:#a6e22e">geom</span>.Matrix<span style="color:#f92672">;</span>
	
	<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">mx</span>.<span style="color:#a6e22e">controls</span>.<span style="color:#a6e22e">Alert</span><span style="color:#f92672">;</span>
	
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PHAImage</span>
	{
		<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">PHAImage</span>()
		{
		}
		
		<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">bmpData</span><span style="color:#f92672">:</span>BitmapData)<span style="color:#f92672">:</span>String
		{
			<span style="color:#75715e">//processing the image
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">trace</span>(<span style="color:#e6db74">&#34;Start processing...n&#34;</span>);
			<span style="color:#75715e">//scaling and converting
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">resizedData</span><span style="color:#f92672">:</span>BitmapData <span style="color:#f92672">=</span> <span style="color:#a6e22e">reduceSize</span>(<span style="color:#a6e22e">bmpData</span><span style="color:#f92672">,</span><span style="color:#ae81ff">8</span><span style="color:#f92672">,</span><span style="color:#ae81ff">8</span>);
			<span style="color:#75715e">//è½¬æ¢ä¸ºç°åº¦
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">greyBmp</span><span style="color:#f92672">:</span>BitmapData <span style="color:#f92672">=</span> <span style="color:#a6e22e">reduceColor</span>(<span style="color:#a6e22e">resizedData</span>);
			<span style="color:#75715e">//è®¡ç®—ç°åº¦å¹³å‡å€¼
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">avgGrey</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> <span style="color:#a6e22e">calcAvgGrey</span>(<span style="color:#a6e22e">greyBmp</span>);
			<span style="color:#a6e22e">trace</span>(<span style="color:#e6db74">&#34;Average GreyScaleï¼š0x&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">avgGrey</span>.<span style="color:#a6e22e">toString</span>(<span style="color:#ae81ff">16</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;n&#34;</span>);
			<span style="color:#75715e">//æ¯”è¾ƒç°åº¦å€¼ä¸å¹³å‡å€¼ï¼Œå»ºç«‹å“ˆå¸ŒæŒ‡çº¹
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">hashArr</span><span style="color:#f92672">:</span>Array <span style="color:#f92672">=</span> <span style="color:#a6e22e">calcAvgHash</span>(<span style="color:#a6e22e">greyBmp</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">avgGrey</span>);
			<span style="color:#a6e22e">trace</span>(<span style="color:#e6db74">&#34;hashArr: &#34;</span><span style="color:#f92672">,</span><span style="color:#a6e22e">hashArr</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>));
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hashArr</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;&#34;</span>);
		}
		
		<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">reduceSize</span>(<span style="color:#a6e22e">source</span><span style="color:#f92672">:</span>BitmapData<span style="color:#f92672">,</span><span style="color:#a6e22e">width</span><span style="color:#f92672">:</span>Number <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span>Number<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)<span style="color:#f92672">:</span>BitmapData
		{
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newData</span><span style="color:#f92672">:</span>BitmapData <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BitmapData(<span style="color:#a6e22e">width</span><span style="color:#f92672">,</span><span style="color:#a6e22e">height</span>);
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">matrix</span><span style="color:#f92672">:</span>Matrix <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Matrix();
			<span style="color:#75715e">//ç¼©å°è‡³ 8x8
</span><span style="color:#75715e"></span>			<span style="color:#a6e22e">matrix</span>.<span style="color:#a6e22e">scale</span>(<span style="color:#a6e22e">newData</span>.<span style="color:#a6e22e">width</span><span style="color:#e6db74">/source.width, newData.height/</span><span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">height</span>);
			<span style="color:#a6e22e">newData</span>.<span style="color:#a6e22e">draw</span>(<span style="color:#a6e22e">source</span><span style="color:#f92672">,</span><span style="color:#a6e22e">matrix</span>);
			
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">newData</span><span style="color:#f92672">;</span>
		}
		
		<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">reduceColor</span>(<span style="color:#a6e22e">source</span><span style="color:#f92672">:</span>BitmapData)<span style="color:#f92672">:</span>BitmapData
		{
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span><span style="color:#f92672">:</span>BitmapData <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BitmapData(<span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">width</span><span style="color:#f92672">,</span><span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">height</span>);
			<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">:</span>int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">height</span><span style="color:#f92672">;</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>)
			{
				<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">j</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">width</span><span style="color:#f92672">;</span> <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span>)
				{
					<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> <span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">getPixel</span>(<span style="color:#a6e22e">i</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">j</span>);
					<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">red</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> (<span style="color:#a6e22e">color</span> <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0</span><span style="color:#a6e22e">xFF0000</span>) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">;</span>
					<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">green</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> (<span style="color:#a6e22e">color</span> <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x00</span><span style="color:#a6e22e">FF00</span>) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span><span style="color:#f92672">;</span>
					<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">blue</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> (<span style="color:#a6e22e">color</span> <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x0000</span><span style="color:#a6e22e">FF</span>) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
					<span style="color:#75715e">//var bwColor:uint = (red + green + blue) / 3;
</span><span style="color:#75715e"></span>					<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">bwColor</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> (<span style="color:#a6e22e">red</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">green</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">59</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">blue</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">11</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span><span style="color:#f92672">;</span>
					<span style="color:#75715e">// puts the average in each channel
</span><span style="color:#75715e"></span>					<span style="color:#a6e22e">bwColor</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">bwColor</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">+</span> (<span style="color:#a6e22e">bwColor</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">bwColor</span><span style="color:#f92672">;</span> 
					<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">setPixel</span>(<span style="color:#a6e22e">i</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">j</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">bwColor</span>);
				}
			}
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span><span style="color:#f92672">;</span>
		}
		
		<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calcAvgGrey</span>(<span style="color:#a6e22e">bmpData</span><span style="color:#f92672">:</span>BitmapData)<span style="color:#f92672">:</span>uint
		{
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vecGrey</span><span style="color:#f92672">:</span><span style="color:#a6e22e">Vector</span>.<span style="color:#f92672">&lt;</span>uint<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">bmpData</span>.<span style="color:#a6e22e">getVector</span>(<span style="color:#a6e22e">bmpData</span>.<span style="color:#a6e22e">rect</span>);
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">total</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">length</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> <span style="color:#a6e22e">vecGrey</span>.<span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
			<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">:</span>int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">length</span><span style="color:#f92672">;</span><span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>)
			{
				<span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> (<span style="color:#a6e22e">vecGrey</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x00</span><span style="color:#a6e22e">FFFFFF</span>);
			}
			
			<span style="color:#66d9ef">return</span> uint(<span style="color:#a6e22e">total</span><span style="color:#f92672">/</span><span style="color:#a6e22e">vecGrey</span>.<span style="color:#a6e22e">length</span>);
		}
		
		<span style="color:#75715e">//è®¡ç®—å“ˆå¸Œ
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">calcAvgHash</span>(<span style="color:#a6e22e">bmpData</span><span style="color:#f92672">:</span>BitmapData<span style="color:#f92672">,</span> <span style="color:#a6e22e">avgValue</span><span style="color:#f92672">:</span>uint)<span style="color:#f92672">:</span>Array
		{
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vecGrey</span><span style="color:#f92672">:</span><span style="color:#a6e22e">Vector</span>.<span style="color:#f92672">&lt;</span>uint<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">bmpData</span>.<span style="color:#a6e22e">getVector</span>(<span style="color:#a6e22e">bmpData</span>.<span style="color:#a6e22e">rect</span>);
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">length</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> <span style="color:#a6e22e">vecGrey</span>.<span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
			<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">hashArr</span><span style="color:#f92672">:</span>Array <span style="color:#f92672">=</span> [];
			<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">:</span>int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">length</span><span style="color:#f92672">;</span><span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>)
			{
				<span style="color:#75715e">//ARGB 32ä½æ•°æ®,åªå–RGB
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pxColor</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span> <span style="color:#a6e22e">vecGrey</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x00</span><span style="color:#a6e22e">FFFFFF</span><span style="color:#f92672">;</span>	
				<span style="color:#75715e">//æ˜¯å¦å°äºç°åº¦å‡å€¼ï¼Œå°äºè®°0ï¼Œå¦åˆ™è®°0
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span>uint <span style="color:#f92672">=</span>  <span style="color:#a6e22e">pxColor</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">avgValue</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span><span style="color:#f92672">;</span>
				<span style="color:#a6e22e">hashArr</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">value</span>);
			}
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hashArr</span><span style="color:#f92672">;</span>
		}
	}
}</code></pre></div>
<p>å€¼å¾—ä¸€æçš„å‡ ç‚¹ï¼š</p>
<ol>
<li>ç°åº¦çš„è½¬æ¢ï¼Œå¯ä»¥é‡‡ç”¨(R+G+B)/3,ä¹Ÿå¯ä»¥(R * 30 + G * 59 + B * 11) / 100ï¼›è€Œä¸”è¿˜æœ‰ç”¨ç§»ä½å–ä»£é™¤æ³•ä»¥è·å¾—æ›´é«˜æ€§èƒ½çš„æ–¹æ³•ï¼›</li>
<li>ActionScript æ²¡æœ‰64ä½æ•´å‹ï¼Œåœ¨è·å¾—æœ€åhashï¼Œæˆ‘è¾“å‡ºæˆäº†å­—ç¬¦ä¸²ã€‚å¦‚æœæƒ³ç”¨64Intå¯ä»¥è‡ªå·±å®šä¹‰ä¸ªæ•°æ®ç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ protoc-gen-as3 çš„Int64/UInt64ã€‚</li>
<li>å›¾åƒç›¸ä¼¼åº¦çš„æ¯”è¾ƒï¼šåªéœ€è®¡ç®—2ä¸ªå“ˆå¸Œå€¼çš„æ±‰æ˜è·ç¦»ï¼Œè·ç¦»è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šé«˜ã€‚</li>
</ol>
<h2 id="å®ä¾‹æ¼”ç¤º">å®ä¾‹æ¼”ç¤º</h2>
<p>ä¸€èˆ¬æœç´¢è¦ç”¨åˆ°æœåŠ¡å™¨ï¼Œä¸ºäº†çœäº‹ï¼Œç›´æ¥å†™äº†ä¸ªç®€å•çš„AIRåº”ç”¨æ¥æµ‹è¯•ç®—æ³•ã€‚æµè§ˆæ–‡ä»¶ç›®å½•ï¼Œéå†å¹¶è®¡ç®—ç›®å½•ä¸‹æ‰€æœ‰å›¾åƒæ–‡ä»¶(jpg,png,gif)çš„å“ˆå¸Œå€¼ã€‚ç„¶åä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œä¾¿ä¼šæ‰¾å‡ºç›®å½•ä¸­ä¸ä¹‹æ±‰æ˜è·ç¦»æœ€çŸ­çš„å›¾ç‰‡ã€‚
<img src="https://pjkm4w.bay.livefilestore.com/y1p8ZntIp9GlbC8AxGFhtTxfA9ToxuWossa6_MVtpU2hk7Otoc5rjJuhzJ58udppAQfPpXhMi7inKD-kMq9L29-TQk6AzXIpw4T/similar_img_air.PNG" alt="demo"></p>
<p>åº”ç”¨æ¯”è¾ƒç²—ç³™ï¼ŒåŒ…å«äº†æµ‹è¯•éœ€è¦çš„åŸºæœ¬åŠŸèƒ½ï¼Œå³ä½¿å›¾åƒè¢«ç¼©å°å¹¶ä¸”å»é™¤äº†è‰²å½©ï¼Œä¾ç„¶å¯ä»¥åŒ¹é…åˆ°ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ç®€è¦ä»‹ç»äº†ç”¨äºå›¾åƒç›¸ä¼¼åº¦åŒ¹é…çš„æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ï¼Œä»¥åŠå…¶ç®€åŒ–ç‰ˆâ€”â€”å¹³å‡å“ˆå¸Œç®—æ³•â€”â€” çš„åŠŸèƒ½ï¼Œç‰¹ç‚¹ä»¥åŠå®ç°æ­¥éª¤ã€‚ä½¿ç”¨ActionScript 3.0 å®ç°äº†å¹³å‡å“ˆå¸Œç®—æ³•å¹¶ç¼–å†™åº”ç”¨æµ‹è¯•ï¼ŒéªŒè¯äº†è¯¥ç®—æ³•çš„æ€§èƒ½å’Œå¯è¡Œæ€§ã€‚</p>
<p>å›¾åƒå¤„ç†çš„ç®—æ³•ä¹Ÿéå¸¸å¤šï¼Œç›®å‰ç›¸ä¼¼å›¾ç‰‡åŒ¹é…çš„ç®—æ³•é™¤äº†ä¸Šè¿°çš„è¿˜æœ‰pHashï¼ŒSIFTç­‰ç­‰ã€‚ä½†æ˜¯å›¾åƒå¤„ç†ä¹Ÿæ˜¯æ•°å­—ä¿¡å·çš„å¤„ç†ï¼Œå› æ­¤é«˜ç­‰æ•°å­¦ï¼Œä¿¡å·å¤„ç†çš„çŸ¥è¯†éå¸¸é‡è¦ï¼Œä¹Ÿæ˜¯æˆ‘éœ€è¦æé«˜å’Œå­¦ä¹ çš„é‡ç‚¹ä¹‹ä¸€ã€‚</p>
<p>åæ§½ï¼šçœ‹äº†Nealçš„å‡ ç¯‡æ–‡ç« ï¼Œé‡Œé¢éƒ½æåˆ°äº† â€œhis next wife, actress Alyson Hanniganâ€ã€‚
<img src="http://lh5.googleusercontent.com/-0iu4m4njVmQ/S3YH3wwXuPI/AAAAAAAABeU/i8jX5uKGCFo/s800/Alyson_Hannigan_200512.jpg" alt="alyson">
ä»¥åŠè¿™æ®µ:</p>
<blockquote>
<p>A couple of people at Reddit complained about my used of Alyson Hannigan as the example image. (Sheâ€™s so cute that she is distracting.) However, it is actually part of my master plan. (Donâ€™t tell Alyson!) Iâ€™m hoping that sheâ€™ll notice it one day and call me. Maybe she and I can double-date at Defcon this yearâ€¦ <em>sigh</em></p>
</blockquote>
<blockquote>
<p>æœ‰å‡ ä¸ªå®¶ä¼™åœ¨Redditä¸ŠæŠ±æ€¨æˆ‘ç”¨Alyson Hanniganä½œä¸ºç¤ºä¾‹å›¾ç‰‡ã€‚ï¼ˆå¥¹å¤ªå¯çˆ±å¤ªè®©æˆ‘ç€è¿·å•¦ï¼‰ä¸ç®¡æ€æ ·ï¼Œè¿™ç¡®å®æ˜¯æˆ‘å®ä¼Ÿè®¡åˆ’çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚ï¼ˆåˆ«å‘Šè¯‰Alysonï¼ï¼‰æˆ‘ç›¼ç€å“ªå¤©å¥¹èƒ½æ³¨æ„åˆ°è¿™ä¸ªè¿˜æ‰“ç”µè¯ç»™æˆ‘ã€‚é‚£æ ·æˆ–è®¸æˆ‘å’Œå¥¹å¯ä»¥åœ¨ä»Šå¹´çš„Defconï¼ˆDEF CON ï¼Œä¸–ç•Œä¸Šè§„æ¨¡æœ€å¤§çš„é»‘å®¢å¤§ä¼šä¹‹ä¸€ï¼‰æ¥ä¸ªDouble-dateï¼ˆåŒåŒçº¦ä¼šï¼Œä¸¤å¯¹æƒ…ä¾£çº¦ä¼šï¼‰ã€‚ã€‚ã€‚å”‰</p>
</blockquote>
<p>ç•¥å¸¦Nerdæ°”è´¨çš„Geeké£èŒƒå°½æ˜¾æ— é—å•Š~ å“ˆå“ˆ ğŸ˜</p>
<hr>
<p><strong>å‚è€ƒèµ„æ–™</strong></p>
<ol>
<li><a href="http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html">http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2011/07/principle_of_similar_image_search.html">http://www.ruanyifeng.com/blog/2011/07/principle_of_similar_image_search.html</a></li>
<li><a href="http://www.cnblogs.com/technology/archive/2012/07/12/Perceptual-Hash-Algorithm.html">http://www.cnblogs.com/technology/archive/2012/07/12/Perceptual-Hash-Algorithm.html</a></li>
<li><a href="http://www.hackerfactor.com/blog/index.php?/archives/355-How-I-Met-Your-Mother-Through-Photoshop.html">http://www.hackerfactor.com/blog/index.php?/archives/355-How-I-Met-Your-Mother-Through-Photoshop.html</a></li>
<li><a href="http://phash.org/">http://phash.org/</a></li>
<li><a href="http://zh.wikipedia.org/wiki/%E7%A6%BB%E6%95%A3%E4%BD%99%E5%BC%A6%E5%8F%98%E6%8D%A2">http://zh.wikipedia.org/wiki/%E7%A6%BB%E6%95%A3%E4%BD%99%E5%BC%A6%E5%8F%98%E6%8D%A2</a></li>
<li><a href="http://blog.csdn.net/lin_zyang/article/details/2603028">http://blog.csdn.net/lin_zyang/article/details/2603028</a></li>
<li><a href="http://blog.csdn.net/v_JULY_v/article/details/6186942">http://blog.csdn.net/v_JULY_v/article/details/6186942</a></li>
<li><a href="http://www.isnowfy.com/similar-image-search/">http://www.isnowfy.com/similar-image-search/</a></li>
<li><a href="http://blog.csdn.net/v_JULY_v/article/details/6186942">http://blog.csdn.net/v_JULY_v/article/details/6186942</a></li>
<li><a href="http://code.google.com/p/protoc-gen-as3/">http://code.google.com/p/protoc-gen-as3/</a></li>
</ol>
</main>

<script src="https://utteranc.es/client.js"
        repo="anthonyhan/anthonyhan.github.io"
        issue-term="title"
        label="ğŸ’¬comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


<footer>
  
  
  <hr/>
  Â© 2005-2021 Anthony | <a href="https://github.com/anthonyhan">Github</a> | <a href="https://twitter.com/antonius_hq">Twitter</a>
  
  </footer>
  
  </body>
</html>

